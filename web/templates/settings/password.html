{{/*###
KyutGrill=settings2.jpg
Include=menu.html
MinPrivileges=2
DisableHH=true
*/}}
{{ define "tpl" }}
<div class="relative min-h-screen py-8">
	<!-- Background with blur -->
	<div class="fixed inset-0 -z-10">
		<div class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-20"
			style="background-image: url('/static/headers/settings2.jpg');"></div>
		<div class="absolute inset-0 bg-gradient-to-b from-dark-bg via-dark-bg/90 to-dark-bg"></div>
	</div>

	<div class="container mx-auto px-4">
		<div class="flex flex-col md:flex-row gap-6">
			{{ template "settingsSidebar" . }}

			<div class="flex-1">
				<div class="card">
					<div class="flex items-center gap-3 mb-6 pb-4 border-b border-dark-border">
						<div class="w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center">
							<i class="fas fa-lock text-primary text-xl"></i>
						</div>
						<div>
							<h2 class="text-2xl font-display font-bold text-white">Change Password</h2>
							<p class="text-sm text-gray-400">Keep your account secure</p>
						</div>
					</div>

					<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
						<!-- Left: Form -->
						<div>
							<form method="post" class="space-y-6" id="password-form">
								<!-- Email -->
								<div>
									<label class="block text-sm font-medium text-gray-300 mb-2">
										<i class="fas fa-envelope mr-2 text-gray-500"></i>Email Address
									</label>
									<input type="email"
										name="email"
										value="{{ if index .FormData "email" }}{{ index (index .FormData "email") 0 }}{{ else }}{{ index .Extra "email" }}{{ end }}"
										required
										class="input-field"
										tabindex="1">
									<p class="text-xs text-gray-500 mt-1">Confirm your email address</p>
								</div>

								<!-- Current Password -->
								<div>
									<label class="block text-sm font-medium text-gray-300 mb-2">
										<i class="fas fa-key mr-2 text-gray-500"></i>Current Password
									</label>
									<div class="relative">
										<input type="password"
											name="currentpassword"
											id="current-password"
											required
											class="input-field pr-12"
											tabindex="2">
										<button type="button"
											class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors"
											onclick="togglePassword('current-password', this)">
											<i class="fas fa-eye"></i>
										</button>
									</div>
									<p class="text-xs text-gray-500 mt-1">Required to make changes</p>
								</div>

								<!-- New Password -->
								<div>
									<label class="block text-sm font-medium text-gray-300 mb-2">
										<i class="fas fa-lock mr-2 text-gray-500"></i>New Password
									</label>
									<div class="relative">
										<input type="password"
											name="newpassword"
											id="new-password"
											value="{{ .FormData.newpassword }}"
											class="input-field pr-12"
											tabindex="3"
											oninput="checkPasswordStrength(this.value)">
										<button type="button"
											class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors"
											onclick="togglePassword('new-password', this)">
											<i class="fas fa-eye"></i>
										</button>
									</div>
									<p class="text-xs text-gray-500 mt-1">Leave blank to keep current password</p>

									<!-- Password Strength Meter -->
									<div id="strength-meter" class="mt-3 hidden">
										<div class="flex items-center justify-between mb-1">
											<span class="text-xs text-gray-400">Password Strength</span>
											<span id="strength-text" class="text-xs font-medium">-</span>
										</div>
										<div class="h-2 bg-dark-bg rounded-full overflow-hidden">
											<div id="strength-bar" class="h-full transition-all duration-300" style="width: 0%"></div>
										</div>
									</div>

									<!-- Password Requirements -->
									<div id="password-requirements" class="mt-4 p-3 bg-dark-bg rounded-lg border border-dark-border hidden">
										<p class="text-xs text-gray-400 mb-2 font-medium">Requirements</p>
										<ul class="space-y-1 text-xs">
											<li id="req-length" class="flex items-center gap-2 text-gray-500">
												<i class="fas fa-circle text-[6px]"></i>
												At least 8 characters
											</li>
											<li id="req-upper" class="flex items-center gap-2 text-gray-500">
												<i class="fas fa-circle text-[6px]"></i>
												One uppercase letter
											</li>
											<li id="req-lower" class="flex items-center gap-2 text-gray-500">
												<i class="fas fa-circle text-[6px]"></i>
												One lowercase letter
											</li>
											<li id="req-number" class="flex items-center gap-2 text-gray-500">
												<i class="fas fa-circle text-[6px]"></i>
												One number
											</li>
										</ul>
									</div>
								</div>

								<!-- Confirm New Password -->
								<div>
									<label class="block text-sm font-medium text-gray-300 mb-2">
										<i class="fas fa-check-double mr-2 text-gray-500"></i>Confirm New Password
									</label>
									<div class="relative">
										<input type="password"
											id="confirm-password"
											class="input-field pr-12"
											tabindex="4"
											oninput="checkPasswordMatch()">
										<button type="button"
											class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors"
											onclick="togglePassword('confirm-password', this)">
											<i class="fas fa-eye"></i>
										</button>
									</div>
									<p id="match-status" class="text-xs mt-1 hidden"></p>
								</div>

								{{ ieForm .Context }}

								<div class="pt-4 border-t border-dark-border flex justify-end">
									<button type="submit"
										class="btn-primary inline-flex items-center gap-2"
										tabindex="5">
										<i class="fas fa-save"></i>
										Update Password
									</button>
								</div>
							</form>
						</div>

						<!-- Right: Security Info -->
						<div class="space-y-6">
							<!-- Security Tips -->
							<div class="p-4 bg-blue-900/20 border border-blue-700/50 rounded-lg">
								<h3 class="text-blue-300 font-medium mb-3 flex items-center gap-2">
									<i class="fas fa-shield-alt"></i>
									Security Tips
								</h3>
								<ul class="space-y-3 text-sm text-gray-400">
									<li class="flex items-start gap-3">
										<i class="fas fa-check-circle text-green-400 mt-0.5"></i>
										<span>Use a unique password that you don't use anywhere else</span>
									</li>
									<li class="flex items-start gap-3">
										<i class="fas fa-check-circle text-green-400 mt-0.5"></i>
										<span>Combine letters, numbers, and special characters</span>
									</li>
									<li class="flex items-start gap-3">
										<i class="fas fa-check-circle text-green-400 mt-0.5"></i>
										<span>Avoid using personal information like birthdays</span>
									</li>
									<li class="flex items-start gap-3">
										<i class="fas fa-check-circle text-green-400 mt-0.5"></i>
										<span>Consider using a password manager</span>
									</li>
								</ul>
							</div>

							<!-- Warning -->
							<div class="p-4 bg-orange-900/20 border border-orange-700/50 rounded-lg">
								<h3 class="text-orange-300 font-medium mb-2 flex items-center gap-2">
									<i class="fas fa-exclamation-triangle"></i>
									Important
								</h3>
								<p class="text-sm text-gray-400">
									After changing your password, you will need to log in again on all your devices.
								</p>
							</div>

							<!-- Account Security Status -->
							<div class="card p-0">
								<div class="p-4 border-b border-dark-border">
									<h3 class="font-medium text-white flex items-center gap-2">
										<i class="fas fa-user-shield text-primary"></i>
										Account Security
									</h3>
								</div>
								<div class="p-4 space-y-3">
									<div class="flex items-center justify-between">
										<span class="text-sm text-gray-400">Password</span>
										<span class="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded">Set</span>
									</div>
									<div class="flex items-center justify-between">
										<span class="text-sm text-gray-400">Email</span>
										<span class="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded">Verified</span>
									</div>
									<div class="flex items-center justify-between">
										<span class="text-sm text-gray-400">Discord</span>
										<a href="/settings/discord" class="text-xs px-2 py-1 bg-primary/20 text-primary rounded hover:bg-primary/30 transition-colors">Link Now</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
function togglePassword(inputId, btn) {
	var input = document.getElementById(inputId);
	var icon = btn.querySelector('i');
	if (input.type === 'password') {
		input.type = 'text';
		icon.classList.remove('fa-eye');
		icon.classList.add('fa-eye-slash');
	} else {
		input.type = 'password';
		icon.classList.remove('fa-eye-slash');
		icon.classList.add('fa-eye');
	}
}

function checkPasswordStrength(password) {
	var meter = document.getElementById('strength-meter');
	var bar = document.getElementById('strength-bar');
	var text = document.getElementById('strength-text');
	var requirements = document.getElementById('password-requirements');

	if (!password) {
		meter.classList.add('hidden');
		requirements.classList.add('hidden');
		return;
	}

	meter.classList.remove('hidden');
	requirements.classList.remove('hidden');

	// Check requirements
	var hasLength = password.length >= 8;
	var hasUpper = /[A-Z]/.test(password);
	var hasLower = /[a-z]/.test(password);
	var hasNumber = /[0-9]/.test(password);

	updateRequirement('req-length', hasLength);
	updateRequirement('req-upper', hasUpper);
	updateRequirement('req-lower', hasLower);
	updateRequirement('req-number', hasNumber);

	// Calculate strength
	var strength = 0;
	if (hasLength) strength += 25;
	if (hasUpper) strength += 25;
	if (hasLower) strength += 25;
	if (hasNumber) strength += 25;

	// Bonus for special chars
	if (/[^A-Za-z0-9]/.test(password)) strength = Math.min(100, strength + 10);
	// Bonus for length
	if (password.length >= 12) strength = Math.min(100, strength + 10);

	bar.style.width = strength + '%';

	if (strength < 25) {
		bar.className = 'h-full transition-all duration-300 bg-red-500';
		text.textContent = 'Weak';
		text.className = 'text-xs font-medium text-red-400';
	} else if (strength < 50) {
		bar.className = 'h-full transition-all duration-300 bg-orange-500';
		text.textContent = 'Fair';
		text.className = 'text-xs font-medium text-orange-400';
	} else if (strength < 75) {
		bar.className = 'h-full transition-all duration-300 bg-yellow-500';
		text.textContent = 'Good';
		text.className = 'text-xs font-medium text-yellow-400';
	} else {
		bar.className = 'h-full transition-all duration-300 bg-green-500';
		text.textContent = 'Strong';
		text.className = 'text-xs font-medium text-green-400';
	}
}

function updateRequirement(id, met) {
	var el = document.getElementById(id);
	var icon = el.querySelector('i');
	if (met) {
		el.classList.remove('text-gray-500');
		el.classList.add('text-green-400');
		icon.classList.remove('fa-circle');
		icon.classList.add('fa-check');
	} else {
		el.classList.remove('text-green-400');
		el.classList.add('text-gray-500');
		icon.classList.remove('fa-check');
		icon.classList.add('fa-circle');
	}
}

function checkPasswordMatch() {
	var newPass = document.getElementById('new-password').value;
	var confirmPass = document.getElementById('confirm-password').value;
	var status = document.getElementById('match-status');

	if (!confirmPass) {
		status.classList.add('hidden');
		return;
	}

	status.classList.remove('hidden');

	if (newPass === confirmPass) {
		status.textContent = 'Passwords match';
		status.className = 'text-xs mt-1 text-green-400';
	} else {
		status.textContent = 'Passwords do not match';
		status.className = 'text-xs mt-1 text-red-400';
	}
}
</script>
{{ end }}
