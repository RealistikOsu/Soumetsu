{{/*###
DisableHH=true
*/}}
{{ define "tpl" }}
<script>
	window.clanId = {{ .Extra.ClanID }};
	window.clanParam = "{{ .Extra.ClanParam }}";
</script>

<div id="clan-app" class="relative min-h-screen py-8">
	<!-- Background with blur -->
	<div class="fixed inset-0 -z-10">
		<div class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-20"
			style="background-image: url('/static/headers/clans.jpg');"></div>
		<div class="absolute inset-0 bg-gradient-to-b from-dark-bg via-dark-bg/90 to-dark-bg"></div>
	</div>

	<!-- Loading State -->
	<div v-if="loading" class="container mx-auto px-4">
		<div class="card flex items-center justify-center py-16">
			<i class="fas fa-spinner fa-spin text-primary text-4xl"></i>
		</div>
	</div>

	<!-- Error State -->
	<div v-else-if="error" class="container mx-auto px-4">
		<div class="card text-center py-16">
			<i class="fas fa-users text-gray-500 text-5xl mb-4"></i>
			<h2 class="text-2xl font-bold text-white mb-2">Clan Not Found</h2>
			<p class="text-gray-400">{{ v "error" }}</p>
		</div>
	</div>

	<!-- Clan Content -->
	<div v-else class="container mx-auto px-4">
		<!-- Clan Header -->
		<div class="card mb-6">
			<div class="flex flex-col md:flex-row items-start md:items-center gap-6">
				<img v-if="clan.icon" :src="clan.icon" alt="Clan Icon" class="w-24 h-24 rounded-lg border-2 border-dark-border">
				<div v-else class="w-24 h-24 rounded-lg border-2 border-dark-border bg-dark-bg flex items-center justify-center">
					<i class="fas fa-users text-4xl text-gray-500"></i>
				</div>
				<div class="flex-1">
					<div class="text-gray-400 mb-1">{{ v "'[' + clan.tag + ']'" }}</div>
					<h1 class="text-4xl font-display font-bold mb-2">{{ v "clan.name" }}</h1>
					<p class="text-gray-300">{{ v "clan.description" }}</p>
				</div>
			</div>
		</div>

		<!-- Mode/CustomMode Tabs -->
		<div class="grid grid-cols-3 gap-2 mb-4">
			<button
				class="px-4 py-2 rounded-lg border text-center transition-colors"
				:class="customMode === 0 ? 'bg-primary border-primary text-white' : 'bg-dark-card border-dark-border text-gray-300 hover:border-primary'"
				:disabled="isCustomModeDisabled(0)"
				@click="setCustomMode(0)">
				Vanilla
			</button>
			<button
				class="px-4 py-2 rounded-lg border text-center transition-colors"
				:class="customMode === 1 ? 'bg-primary border-primary text-white' : 'bg-dark-card border-dark-border text-gray-300 hover:border-primary'"
				:disabled="isCustomModeDisabled(1)"
				@click="setCustomMode(1)">
				Relax
			</button>
			<button
				class="px-4 py-2 rounded-lg border text-center transition-colors"
				:class="customMode === 2 ? 'bg-primary border-primary text-white' : 'bg-dark-card border-dark-border text-gray-300 hover:border-primary'"
				:disabled="isCustomModeDisabled(2)"
				@click="setCustomMode(2)">
				Autopilot
			</button>
		</div>

		<div class="grid grid-cols-4 gap-2 mb-6">
			<button v-for="(name, m) in modeNames" :key="m"
				class="px-3 py-2 rounded-lg border text-center text-sm transition-colors"
				:class="mode === m ? 'bg-primary border-primary text-white' : 'bg-dark-card border-dark-border text-gray-300 hover:border-primary'"
				:disabled="isModeDisabled(m)"
				@click="setMode(m)">
				{{ v "name" }}
			</button>
		</div>

		<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
			<!-- Clan Statistics -->
			<div class="card">
				<div class="flex items-center gap-3 mb-4 pb-4 border-b border-dark-border">
					<i class="fas fa-chart-line text-primary"></i>
					<h3 class="text-xl font-display font-bold">Clan Statistics</h3>
				</div>

				<!-- Loading Stats -->
				<div v-if="statsLoading" class="flex items-center justify-center py-8">
					<i class="fas fa-spinner fa-spin text-primary text-2xl"></i>
				</div>

				<!-- Stats Table -->
				<table v-else-if="stats" class="w-full">
					<tbody>
						<tr class="border-b border-dark-border/50">
							<td class="py-2 text-gray-400">Global Rank</td>
							<td class="py-2 text-right text-white font-semibold">#{{ v "addCommas(stats.rank || 0)" }}</td>
						</tr>
						<tr class="border-b border-dark-border/50">
							<td class="py-2 text-gray-400">PP</td>
							<td class="py-2 text-right text-primary font-semibold">{{ v "addCommas(stats.chosen_mode?.pp || 0)" }}pp</td>
						</tr>
						<tr class="border-b border-dark-border/50">
							<td class="py-2 text-gray-400">Ranked Score</td>
							<td class="py-2 text-right text-white">{{ v "addCommas(stats.chosen_mode?.ranked_score || 0)" }}</td>
						</tr>
						<tr class="border-b border-dark-border/50">
							<td class="py-2 text-gray-400">Total Score</td>
							<td class="py-2 text-right text-white">{{ v "addCommas(stats.chosen_mode?.total_score || 0)" }}</td>
						</tr>
						<tr class="border-b border-dark-border/50">
							<td class="py-2 text-gray-400">Total Playcount</td>
							<td class="py-2 text-right text-white">{{ v "addCommas(stats.chosen_mode?.playcount || 0)" }}</td>
						</tr>
						<tr class="border-b border-dark-border/50">
							<td class="py-2 text-gray-400">Total Replays Watched</td>
							<td class="py-2 text-right text-white">{{ v "addCommas(stats.chosen_mode?.replays_watched || 0)" }}</td>
						</tr>
						<tr>
							<td class="py-2 text-gray-400">Total Hits</td>
							<td class="py-2 text-right text-white">{{ v "addCommas(stats.chosen_mode?.total_hits || 0)" }}</td>
						</tr>
					</tbody>
				</table>

				<div v-else class="text-center py-8 text-gray-400">
					No stats available
				</div>
			</div>

			<!-- Clan Actions & Owner -->
			<div class="space-y-6">
				<!-- Clan Actions -->
				<div v-if="currentUserID > 0">
					<!-- User is owner of this clan -->
					<form v-if="canDisband" method="post" :action="'/clans/' + clanId + '/leave'">
						{{ ieForm .Context }}
						<button type="submit" class="btn-secondary bg-red-600/20 border-red-500/50 hover:bg-red-600/30 w-full">
							Disband Clan
						</button>
					</form>

					<!-- User is member (not owner) of this clan -->
					<form v-else-if="canLeave" method="post" :action="'/clans/' + clanId + '/leave'">
						{{ ieForm .Context }}
						<button type="submit" class="btn-secondary bg-red-600/20 border-red-500/50 hover:bg-red-600/30 w-full">
							Leave Clan
						</button>
					</form>

					<!-- User is in a different clan -->
					<div v-else-if="userClanInfo && !isCurrentUserInThisClan" class="card bg-orange-900/20 border-orange-500/50 text-center">
						<p class="text-orange-300">Already joined a clan</p>
					</div>
				</div>

				<!-- Not logged in -->
				<div v-else class="card bg-blue-900/20 border-blue-500/50 text-center">
					<a href="/login" class="text-blue-300 hover:text-blue-200">Please login to join a clan</a>
				</div>

				<!-- Clan Owner -->
				<div class="card">
					<h3 class="text-xl font-display font-bold mb-2">Clan Owner</h3>
					<p class="text-gray-400 text-sm mb-4">The leader of the clan.</p>

					<div v-if="owner" class="flex items-center gap-3">
						<img :src="avatarURL + '/' + owner.id" :alt="owner.username" class="w-12 h-12 rounded-full border-2 border-dark-border">
						<div>
							<a :href="'/users/' + owner.id" class="text-white hover:text-primary font-semibold">
								{{ v "owner.username" }}
							</a>
							<div class="flex items-center gap-1 text-sm text-gray-400">
								<img :src="'/static/images/new-flags/flag-' + owner.country.toLowerCase() + '.svg'" class="w-4 h-3">
								<span>{{ v "owner.country.toUpperCase()" }}</span>
							</div>
						</div>
					</div>
					<div v-else class="text-gray-400">Loading...</div>
				</div>
			</div>
		</div>

		<!-- Members -->
		<div class="card">
			<h3 class="text-2xl font-display font-bold mb-6">Members</h3>

			<div v-if="members.length === 0" class="text-center py-8 text-gray-400">
				No members yet
			</div>

			<div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
				<a v-for="member in members" :key="member.id"
				   :href="'/users/' + member.id"
				   class="flex items-center gap-3 p-3 rounded-lg bg-dark-bg/50 hover:bg-dark-bg transition-colors">
					<img :src="avatarURL + '/' + member.id" :alt="member.username" class="w-10 h-10 rounded-full border border-dark-border">
					<div class="flex-1 min-w-0">
						<p class="text-white font-semibold truncate">{{ v "member.username" }}</p>
						<div class="flex items-center gap-1 text-xs text-gray-400">
							<img :src="'/static/images/new-flags/flag-' + member.country.toLowerCase() + '.svg'" class="w-3 h-2">
							<span>{{ v "member.country.toUpperCase()" }}</span>
						</div>
					</div>
				</a>
			</div>
		</div>
	</div>
</div>

<script src="/static/vue/vue.js"></script>
<script src="/static/vue/soumetsu-app.js"></script>
<script src="/static/vue/api-client.js"></script>
<script src="/static/vue/pages/clan.js"></script>
{{ end }}
