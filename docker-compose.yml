services:
  soumetsu:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - '8080:80'
    environment:
      - APP_COMPONENT=api
      - SOUMETSU_ENV=development
      - SOUMETSU_PORT=80
    env_file:
      - .env
    volumes:
      # Mount templates and static for live reload during development
      # Changes to these files don't require container rebuild
      - ./web/templates:/app/web/templates:ro
      - ./web/static:/app/web/static:ro
    restart: unless-stopped

  # Development variant with all source mounted (for debugging)
  soumetsu-dev:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - '8081:80'
    environment:
      - APP_COMPONENT=api
      - SOUMETSU_ENV=development
      - SOUMETSU_PORT=80
    env_file:
      - .env
    volumes:
      - ./web:/app/web:ro
    profiles:
      - dev
    restart: unless-stopped
