{{/*###
Handler=/friends
MinPrivileges=2
KyutGrill=friends.jpg
DisableHH=true
*/}}
{{ define "tpl" }}
<div class="relative min-h-screen py-8">
	<!-- Background with blur -->
	<div class="fixed inset-0 -z-10">
		<div class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-20" 
			style="background-image: url('/static/headers/friends.jpg');"></div>
		<div class="absolute inset-0 bg-gradient-to-b from-dark-bg via-dark-bg/90 to-dark-bg"></div>
	</div>

	<div class="container mx-auto px-4">
		<!-- Header -->
		<div class="flex items-center gap-4 mb-8">
			<div class="w-16 h-16 bg-pink-500/20 rounded-full flex items-center justify-center">
				<i class="fas fa-user-friends text-pink-400 text-2xl"></i>
			</div>
			<div>
				<h1 class="text-4xl font-display font-bold text-white">Friends</h1>
				<p class="text-gray-400">On this page you can see all of your friends, and unfriend them as you see fit.</p>
			</div>
		</div>

		{{ $ := . }}
		{{ $page := or (atoint (get .QueryParams "p")) 1 }}
		{{ $friends := .Get "friends?p=%d&l=40&sort=username,asc" $page }}
		
		{{ with $friends }}
			<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-6">
				{{ range .friends }}
					<div class="card text-center hover:border-primary transition-colors{{ if not (has .privileges 1) }} opacity-50{{ end }}">
						<a href="/users/{{ .id }}" class="block">
							<img src="{{ config "APP_AVATAR_URL" .Conf }}/{{ .id }}" 
								alt="Avatar" 
								class="w-full aspect-square rounded-lg mb-4 object-cover border-2 border-dark-border">
							<div class="flex items-center justify-center gap-2 mb-3">
								{{ country .country false }}
								<span class="font-semibold">{{ .username }}</span>
							</div>
							<button class="btn-secondary w-full text-sm py-2" 
								data-userid="{{ .id }}"
								onclick="handleFriendAction(this)">
								<i class="fas {{ if .is_mutual }}fa-heart text-red-400{{ else }}fa-minus text-green-400{{ end }} mr-2"></i>
								<span>{{ if .is_mutual }}Mutual{{ else }}Remove{{ end }}</span>
							</button>
						</a>
					</div>
				{{ end }}
			</div>
		{{ end }}

		{{ $left := gt $page 1 }}
		{{ $right := eq (len (rsin $friends.friends)) 40 }}
		{{ if or $left $right }}
			<div class="flex justify-center gap-2">
				{{ if $left }}
					<a href="/friends?p={{ minus (float $page) 1 }}" class="btn-secondary">
						<i class="fas fa-chevron-left mr-2"></i>
						Previous
					</a>
				{{ end }}
				{{ if $right }}
					<a href="/friends?p={{ plus (float $page) 1 }}" class="btn-secondary">
						Next
						<i class="fas fa-chevron-right ml-2"></i>
					</a>
				{{ end }}
			</div>
		{{ end }}
	</div>
</div>
{{ end }}
